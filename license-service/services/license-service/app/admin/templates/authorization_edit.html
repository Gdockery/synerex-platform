{% extends "base.html" %}
{% block content %}
<div class="card">
  <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
    <div>
      <h3 style="margin: 0 0 0.5rem 0;">Edit Authorization</h3>
      <p style="color: #718096; margin: 0;">{{ auth.authorization_id }}</p>
    </div>
    <a href="/admin/authorizations/{{ auth.authorization_id }}" class="btn btn-secondary">‚Üê Back to Authorization</a>
  </div>

  {% if message %}
  <div class="{% if message_type == 'error' %}error{% else %}ok{% endif %}" style="margin-bottom: 1.5rem;">
    {{ message }}
  </div>
  {% endif %}

  <form method="post" action="/admin/authorizations/{{ auth.authorization_id }}/edit">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
      <div style="background: #f7fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
        <h4 style="margin: 0 0 1rem 0; color: #4a5568; font-size: 1rem;">Basic Information</h4>
        <div class="form-group">
          <label for="authorization_id">Authorization ID</label>
          <input type="text" id="authorization_id" value="{{ auth.authorization_id }}" disabled style="background: #edf2f7; cursor: not-allowed;">
          <div class="info" style="font-size: 0.8rem; color: #718096; margin-top: 0.25rem;">Authorization ID cannot be changed</div>
        </div>
        <div class="form-group">
          <label for="program_id">Program</label>
          <input type="text" id="program_id" value="{{ auth.program_id|upper }}" disabled style="background: #edf2f7; cursor: not-allowed;">
          <div class="info" style="font-size: 0.8rem; color: #718096; margin-top: 0.25rem;">Program cannot be changed</div>
        </div>
        <div class="form-group">
          <label for="template_id">Template ID *</label>
          <input type="text" id="template_id" name="template_id" value="{{ auth.template_id }}" required placeholder="e.g., emv_pro">
        </div>
        <div class="form-group">
          <label for="status">Status *</label>
          <select id="status" name="status" required>
            <option value="active" {% if auth.status == 'active' %}selected{% endif %}>Active</option>
            <option value="suspended" {% if auth.status == 'suspended' %}selected{% endif %}>Suspended</option>
            <option value="terminated" {% if auth.status == 'terminated' %}selected{% endif %}>Terminated</option>
          </select>
        </div>
        <div class="form-group">
          <label for="starts_at">Start Date (YYYY-MM-DD) *</label>
          <input type="date" id="starts_at" name="starts_at" value="{{ auth.starts_at }}" required>
        </div>
        <div class="form-group">
          <label for="ends_at">End Date (YYYY-MM-DD) *</label>
          <input type="date" id="ends_at" name="ends_at" value="{{ auth.ends_at }}" required>
        </div>
      </div>

      <div style="background: #f7fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0;">
        <h4 style="margin: 0 0 1rem 0; color: #4a5568; font-size: 1rem;">Scope & Bindings</h4>
        <div class="form-group">
          <label for="scope_json">Scope JSON</label>
          <textarea id="scope_json" name="scope_json" rows="8" style="font-family: 'Courier New', monospace; font-size: 0.85rem;" required>{{ scope | tojson(indent=2) }}</textarea>
          <div class="info" style="font-size: 0.8rem; color: #718096; margin-top: 0.25rem;">JSON format: {"project_ids":[],"site_ids":[],"meter_ids":[]}</div>
        </div>
        <div class="form-group">
          <label for="bindings_override_json">Bindings Override JSON</label>
          <textarea id="bindings_override_json" name="bindings_override_json" rows="6" style="font-family: 'Courier New', monospace; font-size: 0.85rem;" required>{{ bindings_override | tojson(indent=2) }}</textarea>
          <div class="info" style="font-size: 0.8rem; color: #718096; margin-top: 0.25rem;">JSON format: {"tenant_id":null,"allowed_domains":[]}</div>
        </div>
      </div>
    </div>

    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
      <a href="/admin/authorizations/{{ auth.authorization_id }}" class="btn btn-secondary">Cancel</a>
      <button type="submit" class="btn">üíæ Save Changes</button>
    </div>
  </form>
</div>
{% endblock %}


